<div class="container-fluid py-3 attendance-wrap class-wrap">

  <!-- ===================== EXCEL STYLE HEADER ===================== -->
  <div class="card excel-header-sheet mb-3">

    <!-- top bar -->
    <div class="excel-header-top">
      <div class="d-flex align-items-center gap-2">
        <div class="excel-icon-cell">
          <i class="bi bi-building-fill"></i>
        </div>

        <div class="excel-head-text">
          <div class="excel-head-title">Class Management</div>
          <div class="excel-head-subtitle">
            Manage classes in your system
          </div>
        </div>
      </div>

      <!-- actions -->
      <div class="d-flex gap-2 flex-wrap">
        <button type="button" class="btn excel-btn excel-btn-save" data-bs-toggle="collapse"
          data-bs-target="#createClassBox" aria-expanded="false" aria-controls="createClassBox">
          <i class="bi bi-plus-circle me-1"></i>
          New Class
        </button>
      </div>
    </div>

    <!-- create class -->
    <div class="collapse border-top" id="createClassBox">
      <div class="p-3">
        <div class="excel-addbox">

          <div class="d-flex align-items-start justify-content-between gap-3 flex-wrap">
            <div>
              <div class="excel-addbox-title">
                <i class="bi bi-pencil-square me-1"></i> Create Class
              </div>
            </div>

            <div class="excel-chip">
              <i class="bi bi-lightning-charge-fill me-1"></i>
              Quick create
            </div>
          </div>

          <div class="row g-2 align-items-end mt-2">
            <div class="col-12 col-md-8">
              <label class="excel-field-label">Class Name</label>

              <div class="input-group excel-input-group">
                <span class="input-group-text bg-white">
                  <i class="bi bi-tag-fill text-excel-green"></i>
                </span>

                <input type="text" class="form-control excel-input-bootstrap" placeholder="Class name..."
                  [(ngModel)]="className" />

                @if(className){
                <button type="button" class="btn excel-clear-btn" title="Clear" (click)="className=''">
                  <i class="bi bi-x-circle"></i>
                </button>
                }
              </div>
            </div>

            <div class="col-12 col-md-4 d-grid">
              <button type="button" class="btn excel-btn-save" (click)="createClass()">
                @if(loadingCreate()) {
                  <app-text-loading></app-text-loading>
                } @else {
                  <i class="bi bi-check2-circle me-1"></i>
                  Save
                }
              </button>
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- search -->
    <div class="p-3 border-top">
      <div class="row g-2 align-items-end">
        <div class="col-12 col-lg-12">
          <div class="excel-filter-label">
            <i class="bi bi-search me-1"></i> Search
          </div>

          <div class="input-group excel-input-group">
            <span class="input-group-text bg-white">
              <i class="bi bi-search text-excel-green"></i>
            </span>

            <input type="text" class="form-control excel-input-bootstrap" placeholder="Search class name..."
              [(ngModel)]="searchText" (input)="onSearch()" />

            @if(searchText){
            <button type="button" class="btn excel-clear-btn" title="Clear search" (click)="searchText=''; onSearch()">
              <i class="bi bi-x-circle"></i>
            </button>
            }
          </div>
        </div>

      </div>
    </div>

  </div>

  <!-- ===================== CLASS GRID ===================== -->
  <div class="row g-2">

    @for(c of classes(); track c.class_id) {
    <div class="col-12 col-sm-6 col-lg-4 col-xl-3">

      <div class="card class-card" [class.unassign]="c.class_name === 'unasign'">
        <div class="card-body class-card-body">

          <!-- LEFT -->
          <div class="class-left">

            <div class="class-icon">
              <i class="bi" [ngClass]="c.class_name === 'unasign' ? 'bi-exclamation-triangle-fill' : 'bi-bank2'"></i>
            </div>

            <div class="class-info">

              <!-- inline edit (keep your logic) -->
              @if(isEdit(c.class_id || -1)) {
              <div class="class-edit-wrap">
                <input type="text" class="form-control class-edit-input" [(ngModel)]="selectedClassName"
                  placeholder="Class name..." />

                <!-- cancel icon -->
                <button type="button" class="btn class-cancel-btn" title="Cancel" (click)="cancelEdit()">
                  <i class="bi bi-x"></i>
                </button>
              </div>
              } @else {
              <div class="class-name text-truncate">
                @if(c.class_name !== 'unasign') { {{ c.class_name }} } @else { Unassigned }
              </div>
              }

            </div>

          </div>

          <!-- RIGHT actions -->
          <div class="class-actions ms-auto">

            <button type="button" class="btn action-sq edit" [class.save]="isEdit(c.class_id || -1)"
              [title]="isEdit(c.class_id || -1) ? 'Save' : 'Edit'"
              (click)="isEdit(c.class_id || -1) ? onSaveEdit() : editClass(c)">
              @if(isEdit(c.class_id || -1)) {
              @if(loadingEdit()) {
              <span class="mini-spinner" aria-hidden="true"></span>
              } @else {
              <i class="bi bi-check2-circle"></i>
              }
              } @else {
              <i class="bi bi-pencil-square"></i>
              }
            </button>

            <button type="button" class="btn action-sq delete" title="Delete" (click)="onDeleteClass(c)">
              <i class="bi bi-trash"></i>
            </button>

          </div>

        </div>
      </div>

    </div>
    }

    @if(classes().length === 0) {
    <div class="col-12">
      <div class="card text-center py-5 excel-empty-box">
        <div class="excel-empty-icon">
          <i class="bi bi-folder-x"></i>
        </div>
        <div class="excel-empty-title mt-2">No classes found</div>
        <div class="text-secondary mt-1">Try clearing search or create a new class.</div>
      </div>
    </div>
    }
  </div>

</div>

<app-toast></app-toast>